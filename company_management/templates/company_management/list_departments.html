{% extends 'base.html' %}
{% load static %}
{% block content %}
<!-- Main wrapper  -->
<div id="main-wrapper">
	{% include 'header.html' %}
	{% include 'left-nav.html' %}
	<!-- Page wrapper  -->
	<div class="page-wrapper">
		<!-- Bread crumb -->
		<div class="row page-titles">
			<div class="col-md-5 align-self-center">
				<h3 class="text-primary">Dashboard</h3>
			</div>
			<div class="col-md-7 align-self-center">
				<ol class="breadcrumb">
					<li class="breadcrumb-item"><a href="javascript:void(0)">Home</a></li>
					<li class="breadcrumb-item active">List of Departments</li>
				</ol>
			</div>
		</div>
		<!-- End Bread crumb -->
		<!-- Container fluid  -->
		<div class="container-fluid">
			<!-- Start Page Content -->
			<div class="row">
				<div class="col-12">
					<div class="card">
						<div class="card-body">
							<h4 class="card-title">Departments</h4>
							<div class="row">
                                <div class="col-md-12">
                                    <button id="" class="btn btn-info pull-right" onclick="functAddDepartment();">
                                        <i class="fa fa-fw fa-lg fa-plus"></i>Add Department
                                    </button>
                                </div>
                            </div>
							<h6 class="card-subtitle">Export data to Copy, CSV, Excel, PDF & Print</h6>
							<div class="table-responsive">
								<table id="table_department" class="display nowrap table table-hover"
									cellspacing="0" width="100%">
									<thead>
										<tr>
											<th>No.</th>
											<th>Department Name</th>
											<th>Company</th>
											<th>Action</th>
										</tr>
									</thead>
									<tbody>
										{% for department in all_departments %}
										<tr>
											<td>{{forloop.counter}}</td>
											<td>{{ department.name }}</td>
											<td>
												{% for value in department.company.all %}
													{{ value.name}}
												{% endfor %}
											</td>
											<td>
												<button onclick="functDetailDepartment({{ department.id }}, '{{ department.name }}')"  id="" class="btn btn-outline-success btn-sm" type="button">
                                                    <i title="View Department Details" class="fa fa-dedent"></i>
                                                </button>
                                                <button onclick="functUpdateDepartment({{ department.id }}, '{{ department.name }}')"  id="" class="btn btn-outline-success btn-sm" type="button">
                                                    </i><i title="Edit Department" class="fa fa-edit"></i>
                                                </button>
											</td>
										</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
						</div>
					</div>
					{% include 'footer.html' %}
					<!-- End Page Content -->
				</div>
				<!-- End Container fluid  -->
			</div>
			<!-- End Page wrapper  -->
			<script>
				function functAddDepartment(){
					urldata = "{% url 'addDepartment' %}";
					
					$.ajax({
						type: 'GET',
						cache: false,
						data: {},
						url: urldata,
						success: function (resp) {
							$.confirm({
								title: '<h3>Add Department</h3>',
								content: '' + resp,
								type: 'blue',
								theme: 'material',
								typeAnimated: true,
								boxWidth: '40%',
								useBootstrap: false,
								closeIcon: true,
								buttons: {
									close: {
										text: 'Close',
										btnClass: 'btn-gray',
										action: function () {
										}
									}
								}
							});
						}
					});     
				}

				function functDetailDepartment(deptid, deptname) {
					urldata = "{% url 'detailsDepartment' 999%}".replace(999, deptid);
					$.ajax({
						type: "GET",
						cache: false,
						data: {
							deptid: deptid
						},
						url: urldata,
						success: function (resp) {
							$.confirm({
								title: '<h3>Details Department: <strong class="text-info">' + deptname + ' </strong></h3>',
								content: '' + resp,
								type: 'blue',
								typeAnimated: true,
								boxWidth: '40%',
								useBootstrap: false,
								closeIcon: true,
								buttons: {
									close: {
										text: 'Close',
										btnClass: 'btn-gray close-dialog',
										action: function () {
										}
									}
								}
							});
						}
					});
				}

				function functUpdateDepartment(deptid, deptname) {
					urldata = "{% url 'updateDepartment' 999%}".replace(999, deptid);
					$.ajax({
						type: "GET",
						cache: false,
						data: {
							deptid: deptid
						},
						url: urldata,
						success: function (resp) {
							$.confirm({
								title: '<h3>Update Department: <strong class="text-info">' + deptname + ' </strong></h3>',
								content: '' + resp,
								type: 'blue',
								typeAnimated: true,
								boxWidth: '50%',
								useBootstrap: false,
								closeIcon: true,
								buttons: {
									close: {
										text: 'Close',
										btnClass: 'btn-gray close-dialog',
										action: function () {
										}
									}
								}
							});
						}
					});
				}
			</script>
		</div>
		{% endblock %}
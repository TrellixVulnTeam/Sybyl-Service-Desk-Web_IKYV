{% load crispy_forms_tags %}
{% csrf_token %}

{% if state %}
<div class="card-body">
    <div class="row">
        <div class="col-10">
            <h4 class="card-title">Incidents</h4>
            <h6 class="card-subtitle">Export data to Copy, CSV, Excel, PDF & Print</h6>
        </div>

        <div class="col-2">
            <button id="" class="btn btn-info pull-right" onclick="functAddIncident();">
                <i class="fa fa-fw fa-lg fa-plus"></i>Add Incident
            </button>
        </div>
    </div>
    <br />
    <!-- <h6 class="card-subtitle">Export data to Copy, CSV, Excel, PDF & Print</h6> -->
    <div class="table-responsive">
        <table id="table_incidents" class="display nowrap table table-hover" cellspacing="0"
            width="100%">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Color code</th>
                    <th>Creator</th>
                    <th>Assignee</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for incident in incidents %}
                <tr>
                    <td>{{ incident.title }}</td>
                    <td>{{ incident.status }}</td>
                    <td>{{ incident.priority}}</td>
                    <td>
                        <input type="text" style="background-color: {{ incident.priority.color }}; border: 0;"></input>
                    </td>
                    <td>{{ incident.creator }}</td>
                    
                    <td class="text-center">
                        <span class="badge badge-pill badge-success">{{ incident.assigned }}</span>
                    </td>
                    
                    <td>
                        <a href="{% url 'detailsIncident' incident.id %}">View</a>
                        &nbsp; 
                        <a href="{% url 'updateIncident' incident.id %}">Update</a>
                        &nbsp; 
                        <a href="#"><i class="mdi mdi-delete font-30 align-middle mr-2"></i></a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <br />
</div>


<!-- The Modal -->
<div class="">
    <div id="incidentFormModalDialog" class="modalDialog">
        <div>
            <div id="head">
                <a href="#close" title="Close" class="close2">X</a>
                <h5 class="modalDialog-title">Add Incident</h5>
            </div>
            <hr>

            <div class="modal-body">

                <div class="scrollbar-modal1">
                    <div id="dialog_create_incident">

                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<!-- END The Modal -->

{% else %}
    <h3 class="font-weight-bold">Alert: </h3>
    
    <p>Click on the "x" symbol to close the alert message.</p>
    <div class="alert">
    <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span> 
    <strong>Info!</strong> Please Click on Tab Team and Add Team or Team Members Before Creating Incident
    </div>

{% endif %}

<style>
    .alert {
        padding: 20px;
        background-color: #24a7be;
        color: white;
    }

    .closebtn {
        margin-left: 15px;
        color: white;
        font-weight: bold;
        float: right;
        font-size: 22px;
        line-height: 20px;
        cursor: pointer;
        transition: 0.3s;
    }

    .closebtn:hover {
        color: black;
    }
</style>

<script>
    $('#table_incidents').DataTable();
</script>
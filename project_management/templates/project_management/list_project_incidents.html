{% load crispy_forms_tags %}
{% csrf_token %}

<div class="card-body">
    <div class="row">
        <div class="col-10">
            <!-- <h4 class="card-title">Incidents</h4> -->
        </div>

        <div class="col-2">
            <button id="" class="btn btn-info pull-right" onclick="functAddIncident();">
                <i class="fa fa-fw fa-lg fa-plus"></i>Add Incident
            </button>
        </div>
    </div>
    <br />
    <!-- <h6 class="card-subtitle">Export data to Copy, CSV, Excel, PDF & Print</h6> -->
    <div class="table-responsive">
        <table id="table_incidents" class="display nowrap table table-hover" cellspacing="0"
            width="100%">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Color code</th>
                    <th>Creator</th>
                    <th>Assignee</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for incident in incidents %}
                <tr>
                    <td>{{ incident.title }}</td>
                    <td>{{ incident.status }}</td>
                    <td>{{ incident.priority}}</td>
                    <td>
                        <input type="text" style="background-color: {{ incident.priority.color }}; border: 0;"></input>
                    </td>
                    <td>{{ incident.creator }}</td>
                    
                    <td class="text-center">
                        <span class="badge badge-pill badge-success">{{ incident.assigned }}</span>
                    </td>
                    
                    <td>
                        <button class="btn btn-outline-success btn-sm"
                            onclick="editIncident('{{ incident.id }}', '{{ incident.name }}')">
                            <i title="Manage Incident" class="fa fa-edit"></i>
                        </button>

                        <button onclick="deleteIncident('{{ incident.id }}', '{{ incident.name }}')"
                                class="btn btn-outline-danger btn-sm" type="button">
                            <i title="Delete Incident" class="fa fa-remove"></i>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <br />
</div>


<!-- The Modal -->
<div class="">
    <div id="incidentFormModalDialog" class="modalDialog">
        <div>
            <div id="head">
                <a href="#close" title="Close" class="close2">X</a>
                <h4 class="modalDialog-title" style="text-align: center;">ADD INCIDENT</h4>
            </div>
            <hr>

            <div class="modal-body">

                <div class="scrollbar-modal1">
                    <div id="dialog_create_incident">

                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<!-- END The Modal -->


<script>
    $('#table_incidents').DataTable();

    function functAddIncident() {
        urldata = "{% url 'addIncident'%}";
        $.ajax({
            type: "GET",
            cache: false,
            data: {},
            url: urldata,
            success: function (resp) {
                $('#dialog_create_incident').html(resp);

                window.location = '#incidentFormModalDialog';
                initDialog('modalDialog');
            }
        });
    }

</script>
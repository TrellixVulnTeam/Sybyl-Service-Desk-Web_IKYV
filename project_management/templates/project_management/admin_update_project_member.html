{% load crispy_forms_tags %}
<div class="card-body">
    <div class="basic-form">
        <form class="form-horizontal">
            {% csrf_token %}
            <div class="row col-12">
                <div class="col-12">{{ form.responsibility | as_crispy_field}}</div>
                <input id="id_project" value="{{ project_id }}" style="display: none;"/>
                <input id="id_member" value="{{ member_id }}" style="display: none;"/>
                <input id="id_team" value="{{ team_id }}" style="display: none;"/>
                <input id="id_team_name" value="{{ team_name }}" style="display: none;"/>
            </div>
            <div class="">
                <div class="col-md-12">
                    <button id="btnUpdateTeam" class="btn btn-success ">
                        <i class="fa fa-fw fa-lg fa-save"></i>Update
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>

    $("form").on('submit', function(event){
        event.preventDefault();

        var project_id = $("#id_project").val();
        var member_id = $("#id_member").val();
        var team_id = $("#id_team").val();
        var team_name = $("#id_team_name").val();
        var responsibility_id = $("#id_responsibility").val();

        url_data = "{% url 'saveupdateTeamMember' 999%}".replace(999, member_id);

        $.ajax({
            type: "GET",
            cache: false,
            data: {
                member_id: member_id,
                responsibility_id: responsibility_id, 
                project_id: project_id
            },
            url: url_data,
            success: function (response_data) {
                $('.close-dialog').click();
                if(response_data.success == true){
                    $.ajax({
                        type: "GET",
                        cache: false,
                        data: {
                            tid: team_id,
                            teamName: team_name
                        },
                        url:"{% url 'adminDetailProjectTeamMembers'%}" ,
                        success: function (resp) {
                            $('.list-all-teams').html(resp);
                        }
                    });

                    $.confirm({
                        title: "Success",
                        content: 'Member role updated successfully ' ,
                        type: 'blue',
                        typeAnimated: true,
                        boxWidth: '35%',
                        useBootstrap: false,
                        closeIcon: false,
                            buttons: {
                                formSubmit: {
                                    text: 'OK',
                                    btnClass: 'btn-blue close-dialog',
                                    action: function () {
                                        
                                    }
                                }
                            }
                    });
                }
                else{
                    $.alert({
                        type: 'blue',
                        typeAnimated: true,
                        boxWidth: '40%',
                        useBootstrap: false,
                        theme: 'modern',
                        title: 'Alert!',
                        icon: 'fa fa-exclamation-circle',
                        content: 'Failed to update',
                        confirm: function () {
                            alert('Confirmed!');
                        }
                    });
                }
                
            }
        });

    });

</script>

